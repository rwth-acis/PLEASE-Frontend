<link rel="import" href="../../../bower_components/polymer/polymer.html">

<!--
this element's json upwards data binding can not be used in an array
see https://github.com/Polymer/polymer/issues/1913
will be resolved in polymer 2.0

so far using callback
-->

<dom-module id="jsoneditor-string">
  <template>
    <style>
      textarea {
        overflow: hidden;
        padding: 4px;
        resize: none;
        white-space: pre;
      }
    </style>
    <textarea on-resize="test" id="ta" placeholder="[[schema.placeholder]]" value="[[json]]" on-input="update"></textarea>
  </template>

  <script>
    Polymer({
      is: 'jsoneditor-string',
      properties: { json: { observer: 'resize' } },
      update: function(e) {
        this.setValue(e.target.value)
        setTimeout(() => {e.target.focus()})
        // resize
        this.$.ta.style.height = 0
        this.$.ta.style.width = 0
        this.$.ta.style.height = this.$.ta.scrollHeight
        this.$.ta.style.width = this.$.ta.scrollWidth + 8
      },
      test: function(e) {
        console.log('test')
      },
      attached: function() {
        setTimeout(this.resize.bind(this))
      },
      resize: function() {
        // get size at beginning, workaround issue when not visible
        dummy = document.createElement("span")
        this.$.ta.parentElement.replaceChild(dummy, this.$.ta)
        document.body.append(this.$.ta)
        this.$.ta.style.height = 0
        this.$.ta.style.width = 0
        this.$.ta.style.height = this.$.ta.scrollHeight
        this.$.ta.style.width = this.$.ta.scrollWidth + 8
        dummy.parentElement.replaceChild(this.$.ta, dummy)
      }
    });
  </script>
</dom-module>
